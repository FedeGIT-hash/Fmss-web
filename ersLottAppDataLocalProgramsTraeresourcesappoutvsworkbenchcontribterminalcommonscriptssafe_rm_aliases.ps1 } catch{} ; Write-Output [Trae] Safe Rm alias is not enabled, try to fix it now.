warning: in the working copy of 'client/src/pages/Citas.tsx', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/client/src/pages/Citas.tsx b/client/src/pages/Citas.tsx[m
[1mindex 49148ec..7e26f80 100644[m
[1m--- a/client/src/pages/Citas.tsx[m
[1m+++ b/client/src/pages/Citas.tsx[m
[36m@@ -126,6 +126,7 @@[m [mfunction Citas() {[m
     hora: string;[m
     estado: 'confirmada' | 'pendiente';[m
   } | null>(null);[m
[32m+[m[32m  const [isCreating, setIsCreating] = useState(false);[m
   const editModalRef = useRef<HTMLDivElement | null>(null);[m
 [m
   useEffect(() => {[m
[36m@@ -267,11 +268,13 @@[m [mfunction Citas() {[m
         onComplete: () => {[m
           setEditingCita(null);[m
           setEditForm(null);[m
[32m+[m[32m          setIsCreating(false);[m
         }[m
       });[m
     } else {[m
       setEditingCita(null);[m
       setEditForm(null);[m
[32m+[m[32m      setIsCreating(false);[m
     }[m
   };[m
 [m
[36m@@ -288,36 +291,103 @@[m [mfunction Citas() {[m
     });[m
   };[m
 [m
[32m+[m[32m  const handleCreateClick = () => {[m
[32m+[m[32m    if (!selectedDate) return;[m
[32m+[m[32m    const dateKey = format(selectedDate, 'yyyy-MM-dd');[m
[32m+[m[32m    setIsCreating(true);[m
[32m+[m[32m    setEditingCita({[m
[32m+[m[32m      dateKey,[m
[32m+[m[32m      cita: {[m
[32m+[m[32m        id: '',[m
[32m+[m[32m        cliente: '',[m
[32m+[m[32m        servicio: '',[m
[32m+[m[32m        hora: '10:00',[m
[32m+[m[32m        estado: 'pendiente'[m
[32m+[m[32m      }[m
[32m+[m[32m    });[m
[32m+[m[32m    setEditForm({[m
[32m+[m[32m      cliente: '',[m
[32m+[m[32m      servicio: '',[m
[32m+[m[32m      hora: '10:00',[m
[32m+[m[32m      estado: 'pendiente'[m
[32m+[m[32m    });[m
[32m+[m[32m  };[m
[32m+[m
   const handleSaveEdit = async () => {[m
     if (!editingCita || !editForm) return;[m
 [m
[31m-    const { error } = await supabase[m
[31m-      .from('cita_ui')[m
[31m-      .update({[m
[31m-        cliente: editForm.cliente,[m
[31m-        servicio: editForm.servicio,[m
[31m-        hora: editForm.hora,[m
[31m-        estado: editForm.estado[m
[31m-      })[m
[31m-      .eq('id', editingCita.cita.id);[m
[32m+[m[32m    if (isCreating) {[m
[32m+[m[32m      const { data, error } = await supabase[m
[32m+[m[32m        .from('cita_ui')[m
[32m+[m[32m        .insert({[m
[32m+[m[32m          fecha: editingCita.dateKey,[m
[32m+[m[32m          hora: editForm.hora,[m
[32m+[m[32m          cliente: editForm.cliente,[m
[32m+[m[32m          servicio: editForm.servicio,[m
[32m+[m[32m          estado: editForm.estado[m
[32m+[m[32m        })[m
[32m+[m[32m        .select()[m
[32m+[m[32m        .single();[m
[32m+[m
[32m+[m[32m      if (error) {[m
[32m+[m[32m        console.error('Error creando cita en Supabase:', error);[m
[32m+[m[32m        return;[m
[32m+[m[32m      }[m
 [m
[31m-    if (error) {[m
[31m-      console.error('Error actualizando cita en Supabase:', error);[m
[31m-      return;[m
[32m+[m[32m      setCitasData(prev => {[m
[32m+[m[32m        const copy = { ...prev };[m
[32m+[m[32m        const dayKey = editingCita.dateKey;[m
[32m+[m[32m        if (!copy[dayKey]) {[m
[32m+[m[32m          copy[dayKey] = { fecha: dayKey };[m
[32m+[m[32m        }[m
[32m+[m[32m        const horaRaw = String((data as any).hora ?? '');[m
[32m+[m[32m        const hora = horaRaw.length >= 5 ? horaRaw.slice(0, 5) : horaRaw;[m
[32m+[m[32m        const current = copy[dayKey].citasPendientes || [];[m
[32m+[m[32m        copy[dayKey] = {[m
[32m+[m[32m          ...copy[dayKey],[m
[32m+[m[32m          citasPendientes: [[m
[32m+[m[32m            ...current,[m
[32m+[m[32m            {[m
[32m+[m[32m              id: (data as any).id as string,[m
[32m+[m[32m              cliente: (data as any).cliente as string,[m
[32m+[m[32m              servicio: (data as any).servicio as string,[m
[32m+[m[32m              hora,[m
[32m+[m[32m              estado: (data as any).estado as 'confirmada' | 'pendiente'[m
[32m+[m[32m            }[m
[32m+[m[32m          ][m
[32m+[m[32m        };[m
[32m+[m[32m        return copy;[m
[32m+[m[32m      });[m
[32m+[m[32m    } else {[m
[32m+[m[32m      const { error } = await supabase[m
[32m+[m[32m        .from('cita_ui')[m
[32m+[m[32m        .update({[m
[32m+[m[32m          cliente: editForm.cliente,[m
[32m+[m[32m          servicio: editForm.servicio,[m
[32m+[m[32m          hora: editForm.hora,[m
[32m+[m[32m          estado: editForm.estado[m
[32m+[m[32m        })[m
[32m+[m[32m        .eq('id', editingCita.cita.id);[m
[32m+[m
[32m+[m[32m      if (error) {[m
[32m+[m[32m        console.error('Error actualizando cita en Supabase:', error);[m
[32m+[m[32m        return;[m
[32m+[m[32m      }[m
[32m+[m
[32m+[m[32m      setCitasData(prev => {[m
[32m+[m[32m        const copy = { ...prev };[m
[32m+[m[32m        const day = copy[editingCita.dateKey];[m
[32m+[m[32m        if (!day || !day.citasPendientes) return prev;[m
[32m+[m[32m        copy[editingCita.dateKey] = {[m
[32m+[m[32m          ...day,[m
[32m+[m[32m          citasPendientes: day.citasPendientes.map(c =>[m
[32m+[m[32m            c.id === editingCita.cita.id ? { ...c, ...editForm } : c[m
[32m+[m[32m          )[m
[32m+[m[32m        };[m
[32m+[m[32m        return copy;[m
[32m+[m[32m      });[m
     }[m
 [m
[31m-    setCitasData(prev => {[m
[31m-      const copy = { ...prev };[m
[31m-      const day = copy[editingCita.dateKey];[m
[31m-      if (!day || !day.citasPendientes) return prev;[m
[31m-      copy[editingCita.dateKey] = {[m
[31m-        ...day,[m
[31m-        citasPendientes: day.citasPendientes.map(c =>[m
[31m-          c.id === editingCita.cita.id ? { ...c, ...editForm } : c[m
[31m-        )[m
[31m-      };[m
[31m-      return copy;[m
[31m-    });[m
     closeEditModal();[m
   };[m
 [m
[36m@@ -580,7 +650,10 @@[m [mfunction Citas() {[m
                   </div>[m
                   <p className="text-slate-500 dark:text-slate-400">No hay actividad registrada para este d√≠a.</p>[m
                   {!isSelectedPast && ([m
[31m-                    <button className="text-blue-600 text-sm font-medium hover:underline">[m
[32m+[m[32m                  <button[m
[32m+[m[32m                    className="text-blue-600 text-sm font-medium hover:underline"[m
[32m+[m[32m                    onClick={handleCreateClick}[m
[32m+[m[32m                  >[m
                       + Agregar Cita Nueva[m
                     </button>[m
                   )}[m
[36m@@ -687,6 +760,7 @@[m [mfunction Citas() {[m
                   <motion.button[m
                     variants={itemVariants}[m
                     className="w-full py-3 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-500 dark:text-slate-300 font-medium hover:border-blue-400 dark:hover:border-blue-500 hover:text-blue-500 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-500/10 transition-all flex items-center justify-center gap-2 mt-4"[m
[32m+[m[32m                    onClick={handleCreateClick}[m
                   >[m
                     <span className="text-xl">+</span> Agendar Nueva Cita[m
                   </motion.button>[m
